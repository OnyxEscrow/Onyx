# Cargo configuration for Linux - Monero Marketplace
# Optimized for development and production

[build]
# Enable incremental compilation for faster dev builds
incremental = true
# IMPORTANT: Limite à 2 jobs pour éviter surchauffe CPU i5-8350U
# (Le CPU laptop surchauffe avec 8 jobs parallèles → redémarrage)
jobs = 2

# Clippy configuration for security theatre prevention
[clippy]
all-targets = true
warnings-as-errors = true

# Security theatre prevention - CRITICAL for Monero marketplace
[clippy.deny]
# Production code quality
"clippy::todo" = "No TODO comments in production code"
"clippy::unimplemented" = "No unimplemented! in production code"
"clippy::panic" = "No panic! in production code"
"clippy::unwrap_used" = "No unwrap() without proper error handling"
"clippy::expect_used" = "Use proper error handling instead of expect()"
"clippy::print_stdout" = "Use tracing::info! instead of println!"
"clippy::print_stderr" = "Use tracing::error! instead of eprintln!"
"clippy::dbg_macro" = "No dbg! in production code"

# Security and safety
"clippy::missing_panics_doc" = "Document all panics"
"clippy::missing_errors_doc" = "Document all errors"
"clippy::missing_safety_doc" = "Document all unsafe code"
"clippy::unused_self" = "Remove unused self parameters"
"clippy::needless_pass_by_value" = "Use references instead of owned values"
"clippy::redundant_clone" = "Remove unnecessary clones"

# Performance optimizations
"clippy::large_enum_variant" = "Consider boxing large enum variants"
"clippy::too_many_arguments" = "Consider using a struct for many arguments"
"clippy::type_complexity" = "Simplify complex types"

# Code quality
"clippy::single_match_else" = "Use if let instead of match with single arm"
"clippy::redundant_else" = "Remove redundant else clauses"
"clippy::needless_return" = "Remove unnecessary return statements"

# Monero-specific security
"clippy::cast_lossless" = "Use safe casting methods"
"clippy::cast_possible_truncation" = "Handle potential truncation"
"clippy::float_cmp" = "Use approximate equality for floats"

# Network and I/O security
"clippy::unused_io_amount" = "Handle partial I/O operations"
"clippy::verbose_file_reads" = "Use efficient file reading"

# Development workflow - Mold linker + Hardening
[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = [
    "-C", "link-arg=-fuse-ld=mold",
    "-C", "relro-level=full",       # Protection GOT/PLT (RELRO complet)
    "-C", "target-cpu=native"       # Optimise pour CPU actuel
]
# Note: stack-protector=strong nécessite Rust nightly
# Rust stable utilise déjà des protections de pile par défaut

# Windows targets
[target.x86_64-pc-windows-gnu]
# MinGW linker configuration
linker = "x86_64-w64-mingw32-gcc"

[target.x86_64-pc-windows-msvc]
# MSVC uses default linker (link.exe from Visual Studio)

# Environment variables for build
[env]
# Enable backtraces for better error reporting
RUST_BACKTRACE = "1"
# Limite à 2 jobs (évite surchauffe CPU laptop)
CARGO_BUILD_JOBS = "2"
# Enable colored output
CARGO_TERM_COLOR = "always"