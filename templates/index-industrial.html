{% extends "base-industrial.html" %}

{% block title %}FROST MARKET — TRADE ANONYMOUSLY{% endblock %}

{% block content %}
<!-- Hero Section (Gravity 4) -->
<section class="hero-industrial">
    <div class="hero-industrial__title">
        <h1 class="h1-massive">
            Trade +<br>Anonymous
        </h1>
    </div>

    <div class="hero-industrial__divider"></div>

    <p class="subtitle-tech">
        Monero Only // 2of3 Multisig // Non-Custodial
    </p>

    <div class="hero-industrial__actions">
        <a href="/listings" class="btn-industrial btn-industrial--primary">
            <span>EXPLORE LISTINGS</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
        </a>

        {% if role is defined and role == "vendor" %}
        <a href="/listings/new" class="btn-industrial btn-industrial--sell">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            <span>SELL PRODUCT</span>
        </a>
        {% endif %}
    </div>

    {# Trust Signals - "Grandma Test" reassurance #}
    <div class="nx-trust-bar">
        <div class="nx-trust-bar__item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                <path d="m9 12 2 2 4-4"/>
            </svg>
            <span>2-of-3 Multisig Escrow</span>
        </div>
        <div class="nx-trust-bar__item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
            <span>Non-Custodial</span>
        </div>
        <div class="nx-trust-bar__item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            <span>Monero Privacy</span>
        </div>
    </div>
</section>

<!-- Market Interface Section (Gravity 4) -->
<section class="market-interface container-industrial">
    <!-- Title Row -->
    <h2 class="market-interface__title" style="font-family: var(--font-oswald); font-size: 36px; font-weight: 400;">MARKET INTERFACE</h2>

    <!-- Controls Row -->
    <div class="market-interface__controls">
        <div class="market-interface__left">
            <!-- Search Bar with Instant Search -->
            <form action="/search" method="get" style="margin: 0;">
                <div class="search-industrial search-container">
                    <svg class="search-industrial__icon search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text"
                           id="search-input"
                           class="search-industrial__input"
                           placeholder="Search products..."
                           name="q"
                           autocomplete="off">
                    <span class="search-industrial__count">{{ total_listings | default(value="16") }} RESULTS</span>

                    {# Instant Search Overlay #}
                    <div id="search-overlay" class="search-overlay" role="listbox" aria-label="Search results">
                        {# Populated by JavaScript instant-search.js #}
                    </div>
                </div>
            </form>
        </div>

        <div class="market-interface__right">
            <!-- Sort Dropdown (visual only for now - sorting TBD) -->
            <div class="sort-controls">
                <span class="sort-controls__label">SORT BY:</span>
                <select class="sort-controls__select" name="sort">
                    <option value="newest">NEWEST ARRIVALS</option>
                    <option value="price_asc">PRICE: LOW → HIGH</option>
                    <option value="price_desc">PRICE: HIGH → LOW</option>
                    <option value="popular">MOST POPULAR</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Category Tabs (visual only for now - filtering TBD) -->
    <div class="category-tabs">
        <button class="category-tab category-tab--active" onclick="setActiveTab(this)">
            ALL
        </button>
        <button class="category-tab" onclick="setActiveTab(this)">
            DATA
        </button>
        <button class="category-tab" onclick="setActiveTab(this)">
            HARDWARE
        </button>
        <button class="category-tab" onclick="setActiveTab(this)">
            PHYSICAL
        </button>
        <button class="category-tab" onclick="setActiveTab(this)">
            ACCESS
        </button>
        <button class="category-tab" onclick="setActiveTab(this)">
            SERVICES
        </button>
    </div>

    <!-- Product Grid with Infinite Scroll -->
    <div id="listings-grid" class="product-grid">
        {% for listing in listings %}
            {% include "partials/industrial/product-card.html" %}
        {% else %}
        {# Empty State - Using Unified Design System #}
        <div class="nx-empty-state" style="grid-column: 1 / -1;">
            <div class="nx-empty-state__icon">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                </svg>
            </div>
            <h2 class="nx-empty-state__title">No listings available yet</h2>
            <p class="nx-empty-state__description">
                The marketplace is ready for vendors. Be the first to list your products!
            </p>
            {% if logged_in and role == "vendor" %}
            <a href="/listings/new" class="nx-btn nx-btn--primary nx-btn--lg">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" x2="12" y1="5" y2="19"/>
                    <line x1="5" x2="19" y1="12" y2="12"/>
                </svg>
                Create First Listing
            </a>
            {% elif logged_in %}
            <a href="/profile" class="nx-btn nx-btn--secondary">
                Apply to Become a Vendor
            </a>
            {% else %}
            <a href="/auth/register" class="nx-btn nx-btn--primary nx-btn--lg">
                Get Started
            </a>
            {% endif %}
            <div class="nx-empty-state__hints">
                <div class="nx-empty-state__hint">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    <span>Every transaction protected by 2-of-3 multisig</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Infinite Scroll Trigger -->
    {% if has_more_pages %}
    <div class="infinite-scroll-trigger"
         hx-get="/listings?page={{ next_page }}"
         hx-trigger="revealed"
         hx-swap="beforeend"
         hx-target="#listings-grid">
        <div class="htmx-indicator">
            <div class="spinner"></div>
            <span class="text-mono text-muted" style="font-size: 11px;">LOADING_DATA...</span>
        </div>
    </div>
    {% endif %}
</section>
{% endblock %}

{% block scripts %}
<script nonce="{{ csp_nonce }}">
    // Tab switching
    function setActiveTab(clickedTab) {
        document.querySelectorAll('.category-tab').forEach(tab => {
            tab.classList.remove('category-tab--active');
        });
        clickedTab.classList.add('category-tab--active');
    }

    // HTMX afterSwap - reinitialize any JS that needs it
    document.body.addEventListener('htmx:afterSwap', function(event) {
        console.log('[NEXUS] Content updated:', event.detail.target.id);
    });
</script>
{% endblock %}
