<!-- Aura Modal: Ship Order with Payout Address Selection -->
<div id="ship-payout-modal"
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm transition-opacity duration-300"
    style="display: none;">
    <div
        class="relative w-full max-w-md bg-[#161b22] border border-white/10 rounded-2xl shadow-2xl transform transition-all duration-300 scale-100">
        <!-- Header -->
        <div class="flex items-center justify-between p-6 border-b border-white/5">
            <h3 class="text-xl text-white font-light flex items-center gap-3">
                <div class="p-2 rounded-full bg-cyan-500/10 text-cyan-400">
                    <i data-lucide="truck" class="w-5 h-5"></i>
                </div>
                Mark Order as Shipped
            </h3>
            <button class="text-gray-400 hover:text-white transition-colors" id="close-ship-modal-btn"
                aria-label="Close">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>

        <div class="p-6">
            <form id="ship-payout-form">
                <!-- Payout Address Section -->
                <div class="space-y-4">
                    <label class="text-sm font-medium text-gray-400 flex items-center gap-2">
                        <i data-lucide="wallet" class="w-4 h-4"></i>
                        Where should we send your payment?
                    </label>
                    <p class="text-xs text-gray-500 mb-4">
                        Select where you want to receive the {{ order_amount }} XMR payment after the buyer confirms
                        receipt.
                    </p>

                    <!-- Option 1: Profile Wallet -->
                    <label
                        class="relative block p-4 rounded-xl border border-white/10 bg-white/5 cursor-pointer hover:bg-white/10 transition-colors">
                        <input type="radio" name="payout_option" value="profile" id="payout-profile"
                            class="peer sr-only" {% if has_profile_wallet %}checked{% endif %}>
                        <div
                            class="absolute top-4 right-4 w-5 h-5 rounded-full border border-gray-500 peer-checked:border-cyan-400 peer-checked:bg-cyan-400 flex items-center justify-center transition-all">
                            <div
                                class="w-2 h-2 rounded-full bg-black opacity-0 peer-checked:opacity-100 transition-opacity">
                            </div>
                        </div>
                        <div class="pr-8">
                            <div class="text-sm font-medium text-white mb-1">Use My Profile Wallet</div>
                            <div class="text-xs text-gray-400 mb-2">
                                {% if has_profile_wallet %}
                                Send to your configured profile address
                                {% else %}
                                <span class="text-yellow-400">No wallet configured in settings</span>
                                {% endif %}
                            </div>
                            {% if has_profile_wallet %}
                            <div
                                class="text-xs font-mono text-gray-500 break-all bg-black/20 p-2 rounded border border-white/5">
                                {{ profile_wallet_address }}</div>
                            {% endif %}
                        </div>
                    </label>

                    <!-- Option 2: WASM Wallet (Future) -->
                    <label
                        class="relative block p-4 rounded-xl border border-white/5 bg-white/5 opacity-50 cursor-not-allowed">
                        <input type="radio" name="payout_option" value="wasm" id="payout-wasm" disabled class="sr-only">
                        <div class="pr-8">
                            <div class="text-sm font-medium text-white mb-1 flex items-center gap-2">
                                Generate New WASM Wallet
                                <span
                                    class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-cyan-500/20 text-cyan-400">COMING
                                    SOON</span>
                            </div>
                            <div class="text-xs text-gray-400">
                                Create a new wallet address securely in your browser
                            </div>
                        </div>
                    </label>

                    <!-- Option 3: Custom Address -->
                    <label
                        class="relative block p-4 rounded-xl border border-white/10 bg-white/5 cursor-pointer hover:bg-white/10 transition-colors">
                        <input type="radio" name="payout_option" value="custom" id="payout-custom" class="peer sr-only"
                            {% if not has_profile_wallet %}checked{% endif %}>
                        <div
                            class="absolute top-4 right-4 w-5 h-5 rounded-full border border-gray-500 peer-checked:border-cyan-400 peer-checked:bg-cyan-400 flex items-center justify-center transition-all">
                            <div
                                class="w-2 h-2 rounded-full bg-black opacity-0 peer-checked:opacity-100 transition-opacity">
                            </div>
                        </div>
                        <div class="pr-8">
                            <div class="text-sm font-medium text-white mb-1">Enter Custom Address</div>
                            <div class="text-xs text-gray-400 mb-3">
                                Use a different Monero address
                            </div>
                            <div id="custom-address-input-container" class="transition-all duration-300"
                                style="{% if has_profile_wallet %}display: none;{% endif %}">
                                <input type="text" id="custom-payout-address" name="custom_address"
                                    placeholder="4.../5.../9... (95 characters)" maxlength="106"
                                    class="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-white placeholder-gray-600 text-xs font-mono focus:outline-none focus:border-cyan-500/50 transition-all">
                                <div id="address-validation-feedback" class="mt-1 text-xs"></div>
                            </div>
                        </div>
                    </label>
                </div>

                <!-- Security Notice -->
                <div class="mt-6 p-4 rounded-xl bg-green-500/10 border border-green-500/20 flex gap-3">
                    <i data-lucide="shield-check" class="w-5 h-5 text-green-400 flex-shrink-0"></i>
                    <div>
                        <strong class="text-green-400 text-sm block mb-1">Secured by Monero Multisig</strong>
                        <p class="text-green-400/80 text-xs">
                            By clicking "Confirm & Ship", you're signing the release transaction (1st of 2 signatures).
                            Funds will be released to the address you selected after the buyer confirms receipt (2nd
                            signature).
                        </p>
                    </div>
                </div>
            </form>
        </div>

        <!-- Footer -->
        <div class="p-6 border-t border-white/5 flex gap-3">
            <button type="button" id="cancel-ship-btn"
                class="flex-1 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 transition-colors">
                Cancel
            </button>
            <button type="button" id="confirm-ship-btn"
                class="flex-1 py-2.5 rounded-xl bg-gradient-to-r from-yellow-600 to-orange-600 hover:opacity-90 text-white font-medium transition-opacity shadow-lg shadow-orange-500/20 flex items-center justify-center gap-2">
                <i data-lucide="package-check" class="w-4 h-4"></i>
                Confirm & Ship
            </button>
        </div>
    </div>
</div>

<!-- JS moved to /static/js/ship-payout.js for CSP compliance -->