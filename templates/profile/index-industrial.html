{% extends "base-industrial.html" %}

{% block title %}PROFILE — {{ username | upper }} — FROST MARKET{% endblock %}

{% block content %}
<section class="profile-industrial">
    <div class="container-industrial">
        {# Profile Header #}
        <div class="profile-industrial__header">
            <div class="profile-industrial__identity">
                <div class="profile-industrial__avatar">
                    <span class="profile-industrial__avatar-letter">{{ username | truncate(length=1, end="") | upper }}</span>
                </div>
                <div class="profile-industrial__info">
                    <div class="profile-industrial__status-line">
                        <span class="profile-industrial__status-dot"></span>
                        <span class="profile-industrial__status-text">IDENTITY_ACTIVE</span>
                    </div>
                    <h1 class="profile-industrial__username">{{ username | upper }}</h1>
                    <div class="profile-industrial__role-badge profile-industrial__role-badge--{{ role }}">
                        {{ role | upper }}
                    </div>
                </div>
            </div>

            <div class="profile-industrial__stats">
                <div class="profile-industrial__stat">
                    <span class="profile-industrial__stat-value">{{ orders_count }}</span>
                    <span class="profile-industrial__stat-label">ORDERS</span>
                </div>
                <div class="profile-industrial__stat">
                    <span class="profile-industrial__stat-value">{{ escrows_count }}</span>
                    <span class="profile-industrial__stat-label">ESCROWS</span>
                </div>
                <div class="profile-industrial__stat profile-industrial__stat--highlight">
                    <span class="profile-industrial__stat-value">{{ active_escrows_count | default(value=0) }}</span>
                    <span class="profile-industrial__stat-label">ACTIVE</span>
                </div>
            </div>
        </div>

        {# Tabs Navigation #}
        <div class="profile-industrial__tabs">
            <button class="profile-industrial__tab profile-industrial__tab--active" onclick="showTab('escrows')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
                ESCROW CONTRACTS
                {% if active_escrows_count | default(value=0) > 0 %}
                <span class="profile-industrial__tab-badge">{{ active_escrows_count | default(value=0) }}</span>
                {% endif %}
            </button>
            <button class="profile-industrial__tab" onclick="showTab('orders')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <path d="M16 10a4 4 0 0 1-8 0"/>
                </svg>
                ORDER HISTORY
            </button>
            {% if role == "vendor" %}
            <button class="profile-industrial__tab" onclick="showTab('listings')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                </svg>
                MY LISTINGS
            </button>
            <button class="profile-industrial__tab" onclick="showTab('reputation')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
                REPUTATION
            </button>
            {% endif %}
        </div>

        {# Escrows Panel #}
        <div id="escrows-panel" class="profile-industrial__panel profile-industrial__panel--active">
            <div class="profile-industrial__panel-header">
                <h2 class="profile-industrial__panel-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    2-OF-3 MULTISIG ESCROWS
                </h2>
                <span class="profile-industrial__panel-count">{{ escrows_count }} TOTAL</span>
            </div>

            {% if escrows | length > 0 %}
            <div class="profile-industrial__escrow-list">
                {% for escrow in escrows %}
                <div class="profile-industrial__escrow-card">
                    {# Status Indicator Bar #}
                    <div class="profile-industrial__escrow-status-bar profile-industrial__escrow-status-bar--{{ escrow.status | lower }}"></div>

                    <div class="profile-industrial__escrow-content">
                        {# Left: Main Info #}
                        <div class="profile-industrial__escrow-main">
                            <div class="profile-industrial__escrow-header">
                                <span class="profile-industrial__escrow-id">#{{ escrow.id | truncate(length=8, end="") }}</span>
                                <span class="profile-industrial__escrow-badge {{ escrow.status_class }}">
                                    {{ escrow.status }}
                                </span>
                                {% if escrow.frost_enabled %}
                                <span class="profile-industrial__escrow-frost" title="FROST Threshold Signatures">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                    </svg>
                                    FROST
                                </span>
                                {% endif %}
                            </div>

                            <div class="profile-industrial__escrow-details">
                                <div class="profile-industrial__escrow-detail">
                                    <span class="profile-industrial__escrow-label">ROLE</span>
                                    <span class="profile-industrial__escrow-value profile-industrial__escrow-value--{{ escrow.role }}">
                                        {{ escrow.role | upper }}
                                    </span>
                                </div>
                                <div class="profile-industrial__escrow-detail">
                                    <span class="profile-industrial__escrow-label">COUNTERPARTY</span>
                                    <span class="profile-industrial__escrow-value">{{ escrow.counterparty }}</span>
                                </div>
                                <div class="profile-industrial__escrow-detail">
                                    <span class="profile-industrial__escrow-label">AMOUNT</span>
                                    <span class="profile-industrial__escrow-value profile-industrial__escrow-value--amount">
                                        {{ escrow.amount_xmr }}
                                    </span>
                                </div>
                                <div class="profile-industrial__escrow-detail">
                                    <span class="profile-industrial__escrow-label">CREATED</span>
                                    <span class="profile-industrial__escrow-value">{{ escrow.created_at }}</span>
                                </div>
                            </div>

                            {% if escrow.multisig_address %}
                            <div class="profile-industrial__escrow-address">
                                <span class="profile-industrial__escrow-label">MULTISIG ADDRESS</span>
                                <code class="profile-industrial__escrow-code">{{ escrow.multisig_address | default(value="") | truncate(length=24, end="...") }}</code>
                            </div>
                            {% endif %}
                        </div>

                        {# Right: Actions #}
                        <div class="profile-industrial__escrow-actions">
                            {% if escrow.can_sign and escrow.action_label %}
                            <a href="/escrow/{{ escrow.id }}" class="profile-industrial__escrow-action profile-industrial__escrow-action--primary">
                                {{ escrow.action_label | default(value="Action") }}
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                    <polyline points="12 5 19 12 12 19"/>
                                </svg>
                            </a>
                            {% endif %}
                            <a href="/escrow/{{ escrow.id }}" class="profile-industrial__escrow-action profile-industrial__escrow-action--secondary">
                                View Details
                            </a>
                        </div>
                    </div>

                    {# DKG Progress (if applicable) #}
                    {% if escrow.frost_enabled and not escrow.frost_dkg_complete %}
                    <div class="profile-industrial__escrow-dkg">
                        <div class="profile-industrial__escrow-dkg-label">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            DKG IN PROGRESS
                        </div>
                        <div class="profile-industrial__escrow-dkg-bar">
                            <div class="profile-industrial__escrow-dkg-fill" style="width: 33%;"></div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="profile-industrial__empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
                <h3 class="profile-industrial__empty-title">NO ESCROW CONTRACTS</h3>
                <p class="profile-industrial__empty-text">
                    When you make a purchase, your 2-of-3 multisig escrow contracts will appear here.
                </p>
                <a href="/" class="profile-industrial__empty-action">
                    BROWSE MARKETPLACE
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12 5 19 12 12 19"/>
                    </svg>
                </a>
            </div>
            {% endif %}
        </div>

        {# Orders Panel #}
        <div id="orders-panel" class="profile-industrial__panel">
            <div class="profile-industrial__panel-header">
                <h2 class="profile-industrial__panel-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                    </svg>
                    ORDER HISTORY
                </h2>
                <span class="profile-industrial__panel-count">{{ orders_count }} TOTAL</span>
            </div>

            {% if orders | length > 0 %}
            <div class="profile-industrial__order-list">
                {% for order in orders %}
                <div class="profile-industrial__order-card">
                    <div class="profile-industrial__order-main">
                        <div class="profile-industrial__order-header">
                            <span class="profile-industrial__order-id">#{{ order.id | truncate(length=8, end="") }}</span>
                            <span class="profile-industrial__order-badge {{ order.status_class }}">
                                {{ order.status }}
                            </span>
                        </div>

                        <h3 class="profile-industrial__order-title">{{ order.listing_title }}</h3>

                        <div class="profile-industrial__order-details">
                            <div class="profile-industrial__order-detail">
                                <span class="profile-industrial__order-label">AS</span>
                                <span class="profile-industrial__order-value">{{ order.role | upper }}</span>
                            </div>
                            <div class="profile-industrial__order-detail">
                                <span class="profile-industrial__order-label">WITH</span>
                                <span class="profile-industrial__order-value">{{ order.counterparty }}</span>
                            </div>
                            <div class="profile-industrial__order-detail">
                                <span class="profile-industrial__order-label">TOTAL</span>
                                <span class="profile-industrial__order-value profile-industrial__order-value--amount">
                                    {{ order.total_xmr }}
                                </span>
                            </div>
                            <div class="profile-industrial__order-detail">
                                <span class="profile-industrial__order-label">DATE</span>
                                <span class="profile-industrial__order-value">{{ order.created_at }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-industrial__order-actions">
                        {% if order.escrow_id %}
                        <a href="/escrow/{{ order.escrow_id | default(value="") }}" class="profile-industrial__order-action">
                            View Escrow
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="profile-industrial__empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                    <line x1="3" y1="6" x2="21" y2="6"/>
                </svg>
                <h3 class="profile-industrial__empty-title">NO ORDERS YET</h3>
                <p class="profile-industrial__empty-text">
                    Your order history will appear here once you make your first purchase.
                </p>
                <a href="/" class="profile-industrial__empty-action">
                    START SHOPPING
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12 5 19 12 12 19"/>
                    </svg>
                </a>
            </div>
            {% endif %}
        </div>

        {# Listings Panel (Vendor Only) #}
        {% if role == "vendor" %}
        <div id="listings-panel" class="profile-industrial__panel">
            <div class="profile-industrial__panel-header">
                <h2 class="profile-industrial__panel-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                    </svg>
                    MY LISTINGS
                    {% if listings_count is defined and listings_count > 0 %}
                    <span class="profile-industrial__count">{{ listings_count }}</span>
                    {% endif %}
                </h2>
                <a href="/listings/new" class="profile-industrial__panel-action">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    NEW LISTING
                </a>
            </div>

            {% if listings is defined and listings | length > 0 %}
            <div class="profile-industrial__listings-grid">
                {% for listing in listings %}
                <div class="profile-industrial__listing-card">
                    <div class="profile-industrial__listing-header">
                        <span class="profile-industrial__listing-status profile-industrial__listing-status--{{ listing.status | default(value="active") | lower }}">
                            {{ listing.status | default(value="Active") | upper }}
                        </span>
                        <span class="profile-industrial__listing-category">{{ listing.category | default(value="General") }}</span>
                    </div>
                    <h3 class="profile-industrial__listing-title">{{ listing.title | default(value="Untitled") }}</h3>
                    <div class="profile-industrial__listing-details">
                        <span class="profile-industrial__listing-price">
                            {{ listing.price_xmr | default(value=0) / 1000000000000 | round(precision=4) }} XMR
                        </span>
                        <span class="profile-industrial__listing-stock">
                            Stock: {{ listing.stock | default(value=0) }}
                        </span>
                    </div>
                    <div class="profile-industrial__listing-actions">
                        <a href="/listings/{{ listing.id | default(value='') }}" class="profile-industrial__listing-btn profile-industrial__listing-btn--view">
                            VIEW
                        </a>
                        <a href="/listings/{{ listing.id | default(value='') }}/edit" class="profile-industrial__listing-btn profile-industrial__listing-btn--edit">
                            EDIT
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="profile-industrial__empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                </svg>
                <h3 class="profile-industrial__empty-title">MANAGE YOUR LISTINGS</h3>
                <p class="profile-industrial__empty-text">
                    Create and manage your product listings from here.
                </p>
                <a href="/listings/new" class="profile-industrial__empty-action">
                    CREATE LISTING
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                </a>
            </div>
            {% endif %}
        </div>

        {# Reputation Panel (Vendor Only) #}
        <div id="reputation-panel" class="profile-industrial__panel">
            <div class="profile-industrial__panel-header">
                <h2 class="profile-industrial__panel-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--onyx-gold)" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                    </svg>
                    PORTABLE REPUTATION
                </h2>
            </div>

            <div class="profile-industrial__reputation-section">
                {# Reputation Stats Card #}
                <div class="reputation-stats-card">
                    <div class="reputation-stats-card__header">
                        <h3 class="reputation-stats-card__title">Your Reputation Score</h3>
                        <div class="reputation-stats-card__badge">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                <polyline points="9 12 11 14 15 10"/>
                            </svg>
                            Cryptographically Signed
                        </div>
                    </div>

                    <div class="reputation-stats-card__content">
                        <div class="reputation-stats-card__rating">
                            <div class="reputation-stars reputation-stars--large">
                                <svg class="star star--filled" width="24" height="24" viewBox="0 0 24 24">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                </svg>
                                <svg class="star star--filled" width="24" height="24" viewBox="0 0 24 24">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                </svg>
                                <svg class="star star--filled" width="24" height="24" viewBox="0 0 24 24">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                </svg>
                                <svg class="star star--filled" width="24" height="24" viewBox="0 0 24 24">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                </svg>
                                <svg class="star" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                </svg>
                            </div>
                            <span class="reputation-stats-card__average" id="profile-reputation-average">--</span>
                        </div>

                        <div class="reputation-stats-card__info">
                            <div class="reputation-stats-card__stat">
                                <span class="reputation-stats-card__stat-value" id="profile-review-count">0</span>
                                <span class="reputation-stats-card__stat-label">Total Reviews</span>
                            </div>
                            <div class="reputation-stats-card__stat">
                                <span class="reputation-stats-card__stat-value" id="profile-verified-count">0</span>
                                <span class="reputation-stats-card__stat-label">Verified</span>
                            </div>
                        </div>
                    </div>

                    <p class="reputation-stats-card__description">
                        Your reputation is cryptographically signed by buyers using Ed25519 signatures.
                        Export it to IPFS for a portable, verifiable proof of your transaction history.
                    </p>

                    <a href="/vendor/{{ user_id | default(value='') }}" class="reputation-stats-card__link">
                        View Full Profile
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"/>
                            <polyline points="12 5 19 12 12 19"/>
                        </svg>
                    </a>
                </div>

                {# Reputation Actions #}
                <div class="reputation-actions-card">
                    <h3 class="reputation-actions-card__title">Reputation Actions</h3>

                    <div class="reputation-actions-card__buttons">
                        <button type="button" data-action="open-export-modal" class="btn-gold btn-shimmer reputation-action-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            Export to IPFS
                        </button>

                        <button type="button" data-action="open-verify-modal" class="btn-secondary-outline reputation-action-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                <polyline points="9 12 11 14 15 10"/>
                            </svg>
                            Verify External Reputation
                        </button>
                    </div>

                    <div class="reputation-actions-card__info">
                        <div class="reputation-info-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--onyx-gold)" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="16" x2="12" y2="12"/>
                                <line x1="12" y1="8" x2="12.01" y2="8"/>
                            </svg>
                            <span><strong>Export:</strong> Create a permanent, verifiable record on IPFS</span>
                        </div>
                        <div class="reputation-info-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--onyx-gold)" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="16" x2="12" y2="12"/>
                                <line x1="12" y1="8" x2="12.01" y2="8"/>
                            </svg>
                            <span><strong>Verify:</strong> Check another vendor's exported reputation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

{# Include Reputation Modals (for export/verify functionality) #}
{% if role == "vendor" %}
{% include "reputation/partials/_export_modal.html" ignore missing %}
{% include "reputation/partials/_import_modal.html" ignore missing %}
{% endif %}
{% endblock %}

{% block scripts %}
<script>
function showTab(tabName) {
    // Hide all panels
    document.querySelectorAll('.profile-industrial__panel').forEach(panel => {
        panel.classList.remove('profile-industrial__panel--active');
    });

    // Deactivate all tabs
    document.querySelectorAll('.profile-industrial__tab').forEach(tab => {
        tab.classList.remove('profile-industrial__tab--active');
    });

    // Show selected panel
    const panel = document.getElementById(tabName + '-panel');
    if (panel) {
        panel.classList.add('profile-industrial__panel--active');
    }

    // Activate clicked tab
    event.currentTarget.classList.add('profile-industrial__tab--active');
}

{% if role == "vendor" %}
// Load reputation stats for profile page
document.addEventListener('DOMContentLoaded', async function() {
    try {
        // Fetch vendor's reputation data
        const response = await fetch('/api/reputation/my-stats');
        if (response.ok) {
            const stats = await response.json();

            // Update UI
            const avgEl = document.getElementById('profile-reputation-average');
            const countEl = document.getElementById('profile-review-count');
            const verifiedEl = document.getElementById('profile-verified-count');

            if (avgEl && stats.average_rating !== undefined) {
                avgEl.textContent = stats.average_rating.toFixed(1);
            }
            if (countEl && stats.total_reviews !== undefined) {
                countEl.textContent = stats.total_reviews;
            }
            if (verifiedEl && stats.verified_count !== undefined) {
                verifiedEl.textContent = stats.verified_count;
            }

            // Update stars based on average
            if (stats.average_rating !== undefined) {
                updateStars(stats.average_rating);
            }
        }
    } catch (err) {
        console.log('Could not load reputation stats:', err);
    }
});

function updateStars(rating) {
    const starsContainer = document.querySelector('.reputation-stats-card .reputation-stars');
    if (!starsContainer) return;

    const stars = starsContainer.querySelectorAll('.star');
    const fullStars = Math.floor(rating);

    stars.forEach((star, index) => {
        if (index < fullStars) {
            star.classList.add('star--filled');
            star.setAttribute('fill', 'var(--onyx-gold)');
        } else {
            star.classList.remove('star--filled');
            star.setAttribute('fill', 'none');
        }
    });
}
{% endif %}
</script>

{% if role == "vendor" %}
<script src="/static/js/reputation-export.js"></script>
<script src="/static/js/reputation-import.js"></script>
{% endif %}
{% endblock %}
