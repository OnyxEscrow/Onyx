{% extends "base-industrial.html" %}

{% block title %}Browse Listings — FROST MARKET{% endblock %}

{% block content %}
<div class="market-interface">
    <div class="container-industrial">

        {# ===== HEADER SECTION ===== #}
        <div class="market-header">
            <div class="market-header__left">
                <h1 class="h1-massive">
                    Market <span class="text-gold">Listings</span>
                </h1>
                <p class="market-header__subtitle">
                    Browse verified goods and services secured by 2-of-3 multisig escrow.
                </p>
            </div>

            <div class="market-header__right">
                {# Sorting Navigation #}
                <nav class="market-sort">
                    <a href="/listings?sort=newest" class="market-sort__link market-sort__link--active">
                        Newest
                        <span class="market-sort__indicator"></span>
                    </a>
                    <a href="/listings?sort=trending" class="market-sort__link">Trending</a>
                    <a href="/listings?sort=price_asc" class="market-sort__link">Price: Low</a>
                    <a href="/listings?sort=price_desc" class="market-sort__link">Price: High</a>
                </nav>

                {# Filter Toggle Button #}
                <button onclick="toggleFilters()" class="btn-gold-outline btn-shimmer" style="margin-top: 16px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="4" x2="4" y1="21" y2="14"/><line x1="4" x2="4" y1="10" y2="3"/>
                        <line x1="12" x2="12" y1="21" y2="12"/><line x1="12" x2="12" y1="8" y2="3"/>
                        <line x1="20" x2="20" y1="21" y2="16"/><line x1="20" x2="20" y1="12" y2="3"/>
                        <line x1="1" x2="7" y1="14" y2="14"/><line x1="9" x2="15" y1="8" y2="8"/>
                        <line x1="17" x2="23" y1="16" y2="16"/>
                    </svg>
                    <span>Filters</span>
                </button>
            </div>
        </div>

        {# ===== SEARCH BAR ===== #}
        <div class="search-industrial">
            <svg class="search-industrial__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            <input type="text"
                   class="search-industrial__input"
                   placeholder="Search products, vendors, categories..."
                   id="market-search"
                   autocomplete="off">
            <span class="search-industrial__shortcut">⌘K</span>
        </div>

        {# ===== CATEGORY CHIPS ===== #}
        <div class="category-chips">
            <a href="/listings" class="category-chip category-chip--active">All</a>
            <a href="/listings?category=Digital" class="category-chip">Digital</a>
            <a href="/listings?category=Physical" class="category-chip">Physical</a>
            <a href="/listings?category=Services" class="category-chip">Services</a>
            <a href="/listings?category=Hosting" class="category-chip">Hosting</a>
            <a href="/listings?category=Software" class="category-chip">Software</a>
        </div>

        {# ===== PRODUCT GRID ===== #}
        {% if listings and listings | length > 0 %}
        <div class="product-grid">
            {% for listing in listings %}
                {% include "partials/industrial/product-card.html" %}
            {% endfor %}
        </div>

        {# Pagination #}
        <nav class="pagination-industrial">
            <button class="pagination-industrial__btn" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"/>
                </svg>
            </button>
            <button class="pagination-industrial__btn pagination-industrial__btn--active">1</button>
            <button class="pagination-industrial__btn">2</button>
            <button class="pagination-industrial__btn">3</button>
            <button class="pagination-industrial__btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"/>
                </svg>
            </button>
        </nav>

        {% else %}
        {# ===== EMPTY STATE - Using Unified Design System ===== #}
        <div class="nx-empty-state">
            <div class="nx-empty-state__icon">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.3-4.3"/>
                    <path d="M11 8v6"/>
                    <path d="M8 11h6"/>
                </svg>
            </div>
            <h2 class="nx-empty-state__title">No listings found</h2>
            <p class="nx-empty-state__description">
                {% if category or search_query %}
                No products match your current search or filters. Try adjusting your criteria.
                {% else %}
                Be the first to list on the marketplace! Create a listing to get started.
                {% endif %}
            </p>

            {% if logged_in and role == "vendor" %}
            <a href="/listings/new" class="nx-btn nx-btn--primary nx-btn--lg">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" x2="12" y1="5" y2="19"/>
                    <line x1="5" x2="19" y1="12" y2="12"/>
                </svg>
                Create Your First Listing
            </a>
            {% elif category or search_query %}
            <div class="nx-empty-state__actions">
                <a href="/listings" class="nx-btn nx-btn--secondary">
                    Clear Filters
                </a>
                <a href="/" class="nx-btn nx-btn--ghost">
                    Back to Home
                </a>
            </div>
            {% else %}
            <a href="/auth/register" class="nx-btn nx-btn--primary nx-btn--lg">
                Become a Vendor
            </a>
            {% endif %}

            <div class="nx-empty-state__hints">
                <div class="nx-empty-state__hint">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    <span>All transactions secured by 2-of-3 multisig escrow</span>
                </div>
                <div class="nx-empty-state__hint">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    <span>Complete privacy with Monero payments</span>
                </div>
            </div>
        </div>
        {% endif %}

    </div>
</div>

{# ===== FILTER SIDEBAR ===== #}
<div id="filter-sidebar" class="filter-sidebar">
    <div class="filter-sidebar__header">
        <h2 class="filter-sidebar__title">Filters</h2>
        <button onclick="toggleFilters()" class="filter-sidebar__close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/>
            </svg>
        </button>
    </div>

    <div class="filter-sidebar__content">
        {# Price Range #}
        <div class="filter-section">
            <h3 class="filter-section__title">Price Range</h3>
            <div class="filter-section__range-labels">
                <span>0 XMR</span>
                <span>100 XMR</span>
            </div>
            <input type="range" min="0" max="100" value="100" class="filter-range">
        </div>

        {# Categories #}
        <div class="filter-section">
            <h3 class="filter-section__title">Categories</h3>
            <div class="filter-chips">
                <label class="filter-chip">
                    <input type="checkbox" checked> Digital
                </label>
                <label class="filter-chip">
                    <input type="checkbox" checked> Physical
                </label>
                <label class="filter-chip">
                    <input type="checkbox" checked> Services
                </label>
                <label class="filter-chip">
                    <input type="checkbox" checked> Hosting
                </label>
            </div>
        </div>

        {# Vendor Rating #}
        <div class="filter-section">
            <h3 class="filter-section__title">Minimum Rating</h3>
            <div class="filter-rating">
                <button class="filter-rating__star" data-rating="1">★</button>
                <button class="filter-rating__star" data-rating="2">★</button>
                <button class="filter-rating__star" data-rating="3">★</button>
                <button class="filter-rating__star filter-rating__star--active" data-rating="4">★</button>
                <button class="filter-rating__star" data-rating="5">★</button>
                <span class="filter-rating__label">4+</span>
            </div>
        </div>

        {# Stock Status #}
        <div class="filter-section">
            <h3 class="filter-section__title">Availability</h3>
            <label class="filter-toggle">
                <input type="checkbox" checked>
                <span class="filter-toggle__slider"></span>
                <span class="filter-toggle__label">In Stock Only</span>
            </label>
        </div>
    </div>

    <div class="filter-sidebar__footer">
        <button onclick="toggleFilters()" class="btn-gold-outline btn-shimmer" style="width: 100%;">
            Apply Filters
        </button>
    </div>
</div>

{# Filter Overlay #}
<div id="filter-overlay" class="filter-overlay" onclick="toggleFilters()"></div>
{% endblock %}

{% block scripts %}
<script>
function toggleFilters() {
    const sidebar = document.getElementById('filter-sidebar');
    const overlay = document.getElementById('filter-overlay');

    if (sidebar.classList.contains('filter-sidebar--open')) {
        sidebar.classList.remove('filter-sidebar--open');
        overlay.classList.remove('filter-overlay--visible');
    } else {
        sidebar.classList.add('filter-sidebar--open');
        overlay.classList.add('filter-overlay--visible');
    }
}

// Keyboard shortcut for search
document.addEventListener('keydown', function(e) {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('market-search').focus();
    }
});
</script>
{% endblock %}
