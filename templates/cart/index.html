{% extends "base-aura.html" %}

{% block title %}Shopping Bag - FROST MARKET{% endblock %}

{% block content %}
{% include "components/topbar-aura.html" %}

<div class="min-h-screen pt-24 pb-32">
    {% if cart and cart.items and cart.items | length > 0 %}
    <!-- Cart with items -->
    <div class="w-full max-w-7xl mx-auto px-4 md:px-8 animate-reveal">
        <!-- Header -->
        <h1 class="text-4xl md:text-5xl font-light text-white tracking-wide mb-12">
            Shopping Bag <span class="text-gray-500 text-2xl align-top ml-2">{{ cart.items | length }}</span>
        </h1>

        <div class="flex flex-col lg:flex-row gap-12">

            <!-- Cart Items List -->
            <div class="flex-1 space-y-6">
                {% for item in cart.items %}
                <div class="cart-item-card group relative bg-[#0F1115]/60 backdrop-blur-md border border-white/10 rounded-3xl p-4 md:p-6 flex flex-col md:flex-row gap-6 transition-all duration-300 hover:border-white/20 hover:bg-white/5"
                    data-listing-id="{{ item.listing_id }}">

                    <!-- Image -->
                    <div class="w-full md:w-40 aspect-square md:aspect-[4/3] rounded-2xl overflow-hidden bg-gray-900 relative">
                        {% if item.image_cid %}
                        <img src="/api/listings/{{ item.listing_id }}/images/{{ item.image_cid }}" alt="{{ item.title }}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                        {% else %}
                        <div class="w-full h-full bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center">
                            <i data-lucide="package" class="w-10 h-10 text-gray-700"></i>
                        </div>
                        {% endif %}
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    </div>

                    <!-- Details -->
                    <div class="flex-1 flex flex-col justify-between">
                        <div>
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-xl text-white font-light tracking-wide">{{ item.title }}</h3>
                                    <p class="text-cyan-400 text-sm uppercase tracking-widest mt-1 mb-2">{{ item.vendor_username }}</p>
                                </div>
                                <button
                                    class="remove-item-btn p-2 rounded-full hover:bg-white/10 text-gray-500 hover:text-red-400 transition-colors"
                                    data-listing-id="{{ item.listing_id }}"
                                    title="Remove item">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                </button>
                            </div>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="text-[10px] text-gray-400 border border-white/5 px-2 py-0.5 rounded-full bg-white/5">
                                    {{ item.category | default(value="Product") }}
                                </span>
                            </div>
                        </div>

                        <div class="flex justify-between items-end mt-6">
                            <!-- Quantity Control -->
                            <div class="flex items-center gap-4 bg-black/40 rounded-full px-4 py-2 border border-white/10">
                                <button
                                    class="quantity-decrease text-gray-400 hover:text-white transition-colors disabled:opacity-30"
                                    data-listing-id="{{ item.listing_id }}"
                                    {% if item.quantity <= 1 %}disabled{% endif %}>
                                    <i data-lucide="minus" class="w-4 h-4"></i>
                                </button>
                                <span class="text-white font-mono w-4 text-center">{{ item.quantity }}</span>
                                <button
                                    class="quantity-increase text-gray-400 hover:text-white transition-colors"
                                    data-listing-id="{{ item.listing_id }}">
                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                </button>
                            </div>

                            <!-- Price -->
                            <div class="text-right">
                                <p class="text-xs text-gray-500 uppercase tracking-wide">Item Total</p>
                                <p class="text-xl text-white font-light">{{ item.total_xmr }} XMR</p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Order Summary -->
            <div class="w-full lg:w-96 shrink-0">
                <div class="sticky top-32 bg-[#0F1115]/80 backdrop-blur-xl border border-white/10 rounded-3xl p-8 shadow-2xl">
                    <h2 class="text-xl font-light text-white mb-6">Order Summary</h2>

                    <div class="space-y-4 mb-8">
                        <div class="flex justify-between items-center text-gray-400">
                            <span>Subtotal</span>
                            <span id="cart-subtotal" class="text-white font-mono">{{ cart_total_xmr }} XMR</span>
                        </div>
                        <div class="flex justify-between items-center text-gray-400">
                            <span>Shipping</span>
                            <span class="text-xs text-green-400 border border-green-500/30 bg-green-500/10 px-2 py-0.5 rounded">Calculated at next step</span>
                        </div>
                        <div class="flex justify-between items-center text-gray-400">
                            <span>Escrow Fee</span>
                            <span id="cart-escrow-fee" class="text-white font-mono">~0.00 XMR</span>
                        </div>
                    </div>

                    <div class="w-full h-px bg-white/10 mb-6"></div>

                    <div class="flex justify-between items-center mb-8">
                        <span class="text-lg text-white font-medium">Total</span>
                        <span id="cart-total" class="text-2xl text-cyan-400 font-mono font-light">{{ cart_total_xmr }} XMR</span>
                    </div>

                    {% if logged_in %}
                    <a href="/checkout" class="group relative block w-full rounded-xl p-[1px] overflow-hidden shadow-lg shadow-cyan-900/20 active:scale-[0.99] transition-transform duration-200 mb-4">
                        <div class="absolute inset-[-100%] animate-spin-slow bg-[conic-gradient(from_90deg_at_50%_50%,#00000000_50%,#06b6d4_100%)] opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative w-full py-4 bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-500 hover:to-cyan-500 text-white font-bold rounded-xl flex items-center justify-center gap-2 h-full transition-colors">
                            Secure Checkout
                            <i data-lucide="lock" class="w-4 h-4"></i>
                        </div>
                    </a>
                    {% else %}
                    <a href="/register?redirect=/cart" class="group relative block w-full rounded-xl p-[1px] overflow-hidden shadow-lg shadow-cyan-900/20 active:scale-[0.99] transition-transform duration-200 mb-4">
                        <div class="absolute inset-[-100%] animate-spin-slow bg-[conic-gradient(from_90deg_at_50%_50%,#00000000_50%,#06b6d4_100%)] opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative w-full py-4 bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-500 hover:to-cyan-500 text-white font-bold rounded-xl flex items-center justify-center gap-2 h-full transition-colors">
                            Create Account & Checkout
                            <i data-lucide="lock" class="w-4 h-4"></i>
                        </div>
                    </a>
                    <a href="/login?redirect=/cart" class="block text-center text-sm text-gray-400 hover:text-white transition-colors mb-4">
                        Already have an account? Login
                    </a>
                    {% endif %}

                    <a href="/listings" class="block w-full py-3 rounded-xl border border-white/10 text-gray-400 hover:text-white hover:bg-white/5 transition-colors text-sm text-center">
                        Continue Shopping
                    </a>

                    <div class="mt-6 flex items-center justify-center gap-2 text-[10px] text-gray-500 uppercase tracking-widest">
                        <i data-lucide="lock" class="w-3 h-3"></i>
                        Encrypted PGP Transaction
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- Empty Cart -->
    <div class="min-h-[60vh] flex flex-col items-center justify-center text-center px-4 animate-reveal">
        <div class="w-24 h-24 rounded-full bg-white/5 border border-white/10 flex items-center justify-center mb-6 shadow-2xl shadow-cyan-900/20">
            <i data-lucide="shopping-bag" class="w-10 h-10 text-gray-500"></i>
        </div>
        <h2 class="text-3xl font-light text-white mb-2">Your bag is empty</h2>
        <p class="text-gray-400 max-w-md mb-8">Looks like you haven't found anything yet. Explore our curated universe to find something unique.</p>
        <a href="/listings" class="group relative px-8 py-3 rounded-full overflow-hidden">
            <div class="absolute inset-0 bg-white/5 border border-white/10 group-hover:bg-white/10 transition-colors rounded-full"></div>
            <span class="relative text-cyan-400 group-hover:text-white transition-colors flex items-center gap-2">
                Continue Shopping
                <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </span>
        </a>
    </div>
    {% endif %}
</div>

{% include "components/navigation-aura.html" %}

<script src="/static/js/cart.js"></script>
{% endblock %}
