{% extends "base-industrial.html" %}

{% block title %}Arbiter Dashboard â€” FROST MARKET{% endblock %}

{% block content %}
<div class="arbiter-interface">
    <div class="container-industrial">

        {# ===== HEADER ===== #}
        <div class="arbiter-header">
            <h1 class="h1-massive">
                <span class="text-gold">Arbiter</span> Dashboard
            </h1>
            <p class="arbiter-header__subtitle">
                Resolve disputes and protect the marketplace integrity.
            </p>
        </div>

        {# ===== STATS SUMMARY ===== #}
        <div class="arbiter-stats">
            <div class="arbiter-stat">
                <span class="arbiter-stat__value">{{ stats.active_disputes | default(value=0) }}</span>
                <span class="arbiter-stat__label">Active Disputes</span>
            </div>
            <div class="arbiter-stat arbiter-stat--success">
                <span class="arbiter-stat__value">{{ stats.resolved_total | default(value=0) }}</span>
                <span class="arbiter-stat__label">Resolved</span>
            </div>
        </div>

        {# ===== FILTER TABS ===== #}
        <div class="arbiter-filters">
            <a href="/arbiter/dashboard?filter=active"
               class="arbiter-filter {% if filter == 'active' or not filter %}arbiter-filter--active{% endif %}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                Active Disputes
            </a>
            <a href="/arbiter/dashboard?filter=escalated"
               class="arbiter-filter {% if filter == 'escalated' %}arbiter-filter--warning{% endif %}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                Escalated (Auto)
            </a>
            <a href="/arbiter/dashboard?filter=resolved"
               class="arbiter-filter {% if filter == 'resolved' %}arbiter-filter--success{% endif %}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                Resolved
            </a>
        </div>

        {# ===== DISPUTES LIST ===== #}
        <div class="arbiter-disputes">
            {% if disputes and disputes | length > 0 %}
                {% for dispute in disputes %}
                <div class="dispute-card" style="animation-delay: {{ loop.index0 * 50 }}ms;">
                    <div class="dispute-card__main">
                        {# Status & ID #}
                        <div class="dispute-card__header">
                            <span class="dispute-card__id">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                </svg>
                                #{{ dispute.escrow_id | truncate(length=8, end="") | upper }}
                            </span>

                            {% if dispute.status == 'disputed' %}
                            <span class="dispute-card__status status--warning">Disputed</span>
                            {% elif dispute.status == 'auto_escalated' %}
                            <span class="dispute-card__status status--danger pulse">Auto Escalated</span>
                            {% else %}
                            <span class="dispute-card__status status--success">{{ dispute.status | replace(from="_", to=" ") | title }}</span>
                            {% endif %}
                        </div>

                        {# Dispute Info #}
                        <h3 class="dispute-card__title">
                            {{ dispute.listing_title | default(value="Order Dispute") }}
                        </h3>

                        <div class="dispute-card__parties">
                            <span class="dispute-card__party">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                                Buyer: <strong>{{ dispute.buyer_username | default(value="Anonymous") }}</strong>
                            </span>
                            <span class="dispute-card__party">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/>
                                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                                    <path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/>
                                    <path d="M2 7h20"/>
                                </svg>
                                Vendor: <strong>{{ dispute.vendor_username | default(value="Anonymous") }}</strong>
                            </span>
                        </div>

                        {# Amount #}
                        <div class="dispute-card__amount">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/>
                                <path d="M12 18V6"/>
                            </svg>
                            {{ dispute.amount_xmr | default(value="0.0000") }} XMR
                        </div>
                    </div>

                    <div class="dispute-card__actions">
                        {# Date Info #}
                        {% if dispute.auto_escalated_at %}
                        <span class="dispute-card__date dispute-card__date--danger">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            Escalated {{ dispute.auto_escalated_at }}
                        </span>
                        {% elif dispute.disputed_at %}
                        <span class="dispute-card__date">
                            Opened {{ dispute.disputed_at }}
                        </span>
                        {% elif dispute.created_at %}
                        <span class="dispute-card__date">
                            Created {{ dispute.created_at }}
                        </span>
                        {% endif %}

                        {# Action Button #}
                        {% if dispute.status == 'disputed' or dispute.status == 'auto_escalated' %}
                        <a href="/arbiter/resolve/{{ dispute.escrow_id }}" class="btn-industrial btn-industrial--gold">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="m9 12 2 2 4-4"/>
                            </svg>
                            Resolve Dispute
                        </a>
                        {% else %}
                        <span class="dispute-card__resolved">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            {{ dispute.resolution | default(value="Resolved") }}
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                {# Empty State #}
                <div class="arbiter-empty">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        <path d="m9 12 2 2 4-4"/>
                    </svg>
                    <h3>No Active Disputes</h3>
                    <p>
                        {% if filter == 'resolved' %}
                        No resolved disputes found.
                        {% else %}
                        All disputes have been resolved. Great work!
                        {% endif %}
                    </p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* Arbiter Interface Styles */
.arbiter-interface {
    padding: var(--space-8) 0 var(--space-16);
    min-height: 100vh;
}

.arbiter-header {
    margin-bottom: var(--space-8);
}

.arbiter-header__subtitle {
    color: var(--steel-400);
    font-size: var(--text-sm);
    margin-top: var(--space-2);
}

/* Stats */
.arbiter-stats {
    display: flex;
    gap: var(--space-4);
    margin-bottom: var(--space-6);
}

.arbiter-stat {
    padding: var(--space-4) var(--space-6);
    background: var(--steel-900);
    border: 1px solid var(--steel-700);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    gap: var(--space-3);
}

.arbiter-stat--success {
    border-color: var(--success-500);
    background: rgba(16, 185, 129, 0.1);
}

.arbiter-stat__value {
    font-size: var(--text-2xl);
    font-weight: 600;
    font-family: var(--font-mono);
    color: var(--steel-100);
}

.arbiter-stat--success .arbiter-stat__value {
    color: var(--success-400);
}

.arbiter-stat__label {
    font-size: var(--text-xs);
    color: var(--steel-400);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Filters */
.arbiter-filters {
    display: flex;
    gap: var(--space-2);
    margin-bottom: var(--space-6);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--steel-800);
}

.arbiter-filter {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    color: var(--steel-400);
    text-decoration: none;
    transition: all 0.2s ease;
}

.arbiter-filter:hover {
    color: var(--steel-100);
    background: var(--steel-800);
}

.arbiter-filter--active {
    background: var(--gold-500);
    color: var(--steel-950);
}

.arbiter-filter--active:hover {
    background: var(--gold-400);
    color: var(--steel-950);
}

.arbiter-filter--warning {
    background: rgba(245, 158, 11, 0.2);
    color: var(--warning-400);
    border: 1px solid var(--warning-500);
}

.arbiter-filter--success {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success-400);
    border: 1px solid var(--success-500);
}

/* Dispute Card */
.dispute-card {
    background: var(--steel-900);
    border: 1px solid var(--steel-700);
    border-radius: var(--radius-lg);
    padding: var(--space-6);
    margin-bottom: var(--space-4);
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    animation: fadeInUp 0.3s ease forwards;
    opacity: 0;
    transition: border-color 0.2s ease;
}

.dispute-card:hover {
    border-color: var(--gold-500);
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dispute-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
}

.dispute-card__id {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--steel-400);
}

.dispute-card__status {
    padding: var(--space-1) var(--space-3);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.status--warning {
    background: rgba(245, 158, 11, 0.2);
    color: var(--warning-400);
    border: 1px solid var(--warning-500);
}

.status--danger {
    background: rgba(239, 68, 68, 0.2);
    color: var(--danger-400);
    border: 1px solid var(--danger-500);
}

.status--danger.pulse {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

.status--success {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success-400);
    border: 1px solid var(--success-500);
}

.dispute-card__title {
    font-size: var(--text-lg);
    font-weight: 500;
    color: var(--steel-100);
    margin: var(--space-2) 0;
}

.dispute-card__parties {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-4);
}

.dispute-card__party {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--steel-400);
}

.dispute-card__party strong {
    color: var(--steel-200);
}

.dispute-card__amount {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--gold-400);
    margin-top: var(--space-2);
}

.dispute-card__actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: var(--space-4);
    border-top: 1px solid var(--steel-800);
}

.dispute-card__date {
    font-size: var(--text-xs);
    color: var(--steel-500);
}

.dispute-card__date--danger {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    color: var(--danger-400);
}

.dispute-card__resolved {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--success-400);
}

/* Empty State */
.arbiter-empty {
    text-align: center;
    padding: var(--space-16) var(--space-8);
    background: var(--steel-900);
    border: 1px solid var(--steel-700);
    border-radius: var(--radius-lg);
}

.arbiter-empty svg {
    color: var(--success-400);
    opacity: 0.5;
    margin-bottom: var(--space-4);
}

.arbiter-empty h3 {
    font-size: var(--text-xl);
    color: var(--steel-100);
    margin-bottom: var(--space-2);
}

.arbiter-empty p {
    font-size: var(--text-sm);
    color: var(--steel-400);
}

@media (min-width: 768px) {
    .dispute-card {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
    }

    .dispute-card__actions {
        flex-direction: column;
        align-items: flex-end;
        gap: var(--space-3);
        padding-top: 0;
        border-top: none;
        padding-left: var(--space-4);
        border-left: 1px solid var(--steel-800);
    }
}
</style>
{% endblock %}
