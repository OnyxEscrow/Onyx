{% extends "base-industrial.html" %}

{% block title %}Settings â€” FROST MARKET{% endblock %}

{% block content %}
<div class="settings-interface">
    <div class="container-industrial" style="max-width: 800px;">

        {# ===== HEADER ===== #}
        <div class="settings-header">
            <h1 class="h1-massive">
                <span class="text-gold">Settings</span>
            </h1>
            <p class="settings-header__subtitle">
                Manage your account settings and preferences.
            </p>
        </div>

        {# ===== ACCOUNT INFORMATION ===== #}
        <section class="settings-section">
            <div class="settings-section__header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--nexus-gold)" stroke-width="2">
                    <circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 1 0-16 0"/>
                </svg>
                <h2 class="settings-section__title">Account Information</h2>
            </div>

            <div class="settings-grid">
                <div class="settings-field">
                    <label class="settings-field__label">Username</label>
                    <div class="settings-field__value">{{ username }}</div>
                </div>

                <div class="settings-field">
                    <label class="settings-field__label">Role</label>
                    <div class="settings-field__value settings-field__value--role">
                        {% if role == "vendor" %}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--nexus-gold)" stroke-width="2">
                            <path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/>
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                            <path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/>
                        </svg>
                        <span class="text-gold">VENDOR</span>
                        {% else %}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                            <line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>
                        </svg>
                        <span>BUYER</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        {# ===== WALLET CONFIGURATION (Vendors Only) ===== #}
        {% if role == "vendor" %}
        <section class="settings-section">
            <div class="settings-section__header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--nexus-gold)" stroke-width="2">
                    <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/>
                    <path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/>
                </svg>
                <div>
                    <h2 class="settings-section__title">Monero Wallet</h2>
                    <p class="settings-section__subtitle">Configure your Monero address to receive payments.</p>
                </div>
            </div>

            {# Current Wallet Display #}
            <div id="wallet-result" class="wallet-status">
                {% if wallet_address %}
                <div class="wallet-status--configured">
                    <div class="wallet-status__label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                        Current Wallet Address
                    </div>
                    <div class="wallet-status__address">{{ wallet_address }}</div>
                </div>
                {% else %}
                <div class="wallet-status--warning">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                        <line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/>
                    </svg>
                    <div>
                        <strong>Wallet Address Not Configured</strong>
                        <p>You must configure your Monero wallet address before you can mark orders as shipped and receive payments.</p>
                    </div>
                </div>
                {% endif %}
            </div>

            {# Update Form #}
            <form hx-post="/api/settings/update-wallet"
                  hx-target="#wallet-result"
                  hx-swap="innerHTML"
                  hx-indicator="#wallet-spinner"
                  class="wallet-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                <div class="wallet-form__field">
                    <label for="wallet_address" class="wallet-form__label">
                        {% if wallet_address %}Update Wallet Address{% else %}Wallet Address{% endif %}
                        <span class="text-gold">*</span>
                    </label>
                    <input type="text"
                           id="wallet_address"
                           name="wallet_address"
                           class="wallet-form__input"
                           placeholder="4... 8... (mainnet) or 9... A... B... (testnet)"
                           required
                           minlength="95"
                           maxlength="106"
                           autocomplete="off">
                    <span class="wallet-form__hint">
                        Valid Monero address: mainnet (4 or 8) / testnet (9, A, B), 95-106 characters
                    </span>
                </div>

                <button type="submit" class="btn-gold-outline btn-shimmer wallet-form__submit">
                    <span>{% if wallet_address %}Update Wallet Address{% else %}Save Wallet Address{% endif %}</span>
                    <span id="wallet-spinner" class="htmx-indicator">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="spin">
                            <line x1="12" x2="12" y1="2" y2="6"/><line x1="12" x2="12" y1="18" y2="22"/>
                            <line x1="4.93" x2="7.76" y1="4.93" y2="7.76"/><line x1="16.24" x2="19.07" y1="16.24" y2="19.07"/>
                            <line x1="2" x2="6" y1="12" y2="12"/><line x1="18" x2="22" y1="12" y2="12"/>
                            <line x1="4.93" x2="7.76" y1="19.07" y2="16.24"/><line x1="16.24" x2="19.07" y1="7.76" y2="4.93"/>
                        </svg>
                    </span>
                </button>
            </form>
        </section>
        {% endif %}

    </div>
</div>
{% endblock %}
